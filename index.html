<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoÄŸum GÃ¼nÃ¼n Kutlu Olsun Fatih!</title>
    
    <!-- Tailwind CSS'i yÃ¼klÃ¼yoruz --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts'tan "Pacifico" (el yazÄ±sÄ±) ve "Montserrat" (modern) fontlarÄ±nÄ± yÃ¼klÃ¼yoruz --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Pacifico&display=swap" rel="stylesheet">

    <style>
        /* Tailwind'e Ã¶zel fontlarÄ±mÄ±zÄ± ekleyelim */
        .font-pacifico {
            font-family: 'Pacifico', cursive;
        }
        .font-montserrat {
            font-family: 'Montserrat', sans-serif;
        }

        /* --- Arka Plan Animasyonu --- */
        body {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden; /* TaÅŸmayÄ± engelle */
            position: relative;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Konfeti Efekti iÃ§in CSS */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--color);
            border-radius: 50%;
            animation: fall var(--duration) linear forwards;
            opacity: 0;
            z-index: 9999;
        }

        @keyframes fall {
            0% {
                transform: translateY(0) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotateZ(720deg);
                opacity: 0;
            }
        }
        
        /* --- Pasta ve Mumlar iÃ§in Ã–zel CSS KodlarÄ± --- */
        .cake-container {
            position: relative;
            width: 280px; /* Daha bÃ¼yÃ¼k pasta */
            height: 200px;
            margin-top: 80px; /* Mumlar iÃ§in yer aÃ§ */
            margin-bottom: 40px;
            perspective: 1000px; /* 3D efekti iÃ§in */
        }

        .cake-base {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) rotateX(10deg); /* Hafif 3D gÃ¶rÃ¼nÃ¼m */
            width: 280px;
            height: 120px;
            background: #FFC0CB; /* AÃ§Ä±k pembe pasta katmanÄ± */
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5), inset 0 -5px 10px rgba(0,0,0,0.2);
            border-bottom: 8px solid #E0BBE4; /* Koyu pembe taban */
        }

        .icing-top {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%) rotateX(10deg);
            width: 270px; /* Pastadan biraz kÃ¼Ã§Ã¼k */
            height: 40px;
            background: #fdf6e3; /* Krema rengi */
            border-radius: 50% / 25px; /* Daha belirgin damla efekti */
            border: 3px solid #eee;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2;
        }

        .decoration-edge {
            position: absolute;
            bottom: 110px; /* PastanÄ±n Ã¼st kenarÄ± */
            left: 50%;
            transform: translateX(-50%) rotateX(10deg);
            width: 290px;
            height: 20px;
            background: repeating-linear-gradient(45deg, #f7d794, #f7d794 5px, #fec7d7 5px, #fec7d7 10px); /* Dekoratif desen */
            border-radius: 10px 10px 0 0;
            z-index: 1;
        }

        .candle-set {
            position: absolute;
            width: 100%;
            height: 100px;
            bottom: 120px; /* PastanÄ±n Ã¼zerinde */
            left: 0;
            display: flex;
            justify-content: space-evenly; /* MumlarÄ± eÅŸit daÄŸÄ±t */
            align-items: flex-end;
            z-index: 10;
        }

        .small-candle {
            position: relative;
            width: 12px; /* Daha kÃ¼Ã§Ã¼k mumlar */
            height: 40px;
            background: linear-gradient(to right, #FFD700, #FFA500); /* AltÄ±n rengi mumlar */
            border: 1px solid #fff;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s ease-out; /* TÄ±klama iÃ§in */
        }

        .small-candle:hover {
            transform: scale(1.05);
        }

        .small-candle .wick {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 6px;
            background: #333;
        }

        .small-candle .flame {
            position: absolute;
            top: -18px; /* Fitilin Ã¼stÃ¼nde */
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 16px;
            background: #ffecb3; /* Daha aÃ§Ä±k alev */
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            box-shadow: 0 0 8px #ffd700, 0 0 15px #ffa500, 0 0 3px #f00;
            animation: flicker 0.8s infinite alternate;
            transition: all 0.3s ease-out;
            opacity: 1;
            pointer-events: none; /* Mumun tÄ±klanmasÄ±nÄ± engellemesin */
        }

        /* Tek bir alev iÃ§in deÄŸil, tÃ¼m alevler iÃ§in flicker animasyonu */
        .small-candle .flame.out {
            opacity: 0;
            transform: translateX(-50%) translateY(5px) scale(0);
        }

        .small-candle .smoke {
            position: absolute;
            top: -18px;
            left: 50%;
            width: 8px;
            height: 10px;
            background: #999;
            border-radius: 50%;
            opacity: 0;
            transform: translateX(-50%);
            transition: all 0.8s ease-out;
            z-index: 5;
        }

        .small-candle .flame.out + .smoke {
            opacity: 0.7;
            transform: translateX(-50%) translateY(-20px) scale(1.5);
        }

        .message-box {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

    </style>
</head>
<body class="font-montserrat text-white">

    <!-- Ana BaÅŸlÄ±k --><h1 class="text-5xl md:text-7xl font-extrabold text-white drop-shadow-lg mb-8 animate-fade-in font-pacifico leading-tight">
        DoÄŸum GÃ¼nÃ¼n Kutlu Olsun Fatihim!
    </h1>

    <!-- Bilgilendirme ve Mesaj Kutusu --><div class="message-box text-center mb-10 mx-auto max-w-xl">
        <p id="info-text" class="text-xl md:text-2xl mb-4 transition-opacity duration-700 font-semibold">
            Mumlara Ã¼flemek iÃ§in mikrofona konuÅŸ!
        </p>
        <p id="status-text" class="text-lg text-gray-200"></p>
        <button id="startButton" class="mt-4 px-6 py-3 bg-pink-500 hover:bg-pink-600 text-white font-bold rounded-full shadow-lg transition transform hover:scale-105 duration-300">
            Mikrofonu BaÅŸlat
        </button>
    </div>
    
    <!-- Pasta ve Mumlar AlanÄ± --><div class="cake-container">
        <div class="cake-base"></div>
        <div class="decoration-edge"></div>
        <div class="icing-top"></div>
        
        <div class="candle-set">
            <!-- 5 adet kÃ¼Ã§Ã¼k mum --><div class="small-candle" data-id="1">
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="small-candle" data-id="2">
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="small-candle" data-id="3">
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="small-candle" data-id="4">
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
            <div class="small-candle" data-id="5">
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="smoke"></div>
            </div>
        </div>
    </div>

    <!-- Ä°mza --><p class="text-3xl font-medium text-white italic mt-16 font-pacifico drop-shadow-lg">
        Fatihime Ã¶zel ~ Kayra
    </p>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const flames = document.querySelectorAll('.small-candle .flame');
            const infoText = document.getElementById('info-text');
            const statusText = document.getElementById('status-text');
            const startButton = document.getElementById('startButton');
            let blownOutCount = 0;
            const totalCandles = flames.length;
            let audioContext;
            let analyser;
            let microphone;
            let isListening = false;
            let confettiInterval;

            // Konfeti oluÅŸturma fonksiyonu
            function createConfetti() {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                document.body.appendChild(confetti);

                const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722', '#795548', '#9e9e9e', '#607d8b'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = (Math.random() * 2 + 3) + 's'; // 3-5 saniye

                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }

            // TÃ¼m alevleri sÃ¶ndÃ¼r
            function blowOutAllFlames() {
                flames.forEach(flame => {
                    if (!flame.classList.contains('out')) {
                        flame.classList.add('out');
                        blownOutCount++;
                    }
                });
                
                if (blownOutCount === totalCandles && isListening) {
                    stopListening();
                    infoText.textContent = "Ä°yi ki doÄŸdun Fatihim! ðŸŽ‰";
                    statusText.textContent = "Dileklerin gerÃ§ek olsun! ðŸ’–";
                    startButton.style.display = 'none'; // Butonu gizle
                    
                    // Konfeti yaÄŸmurunu baÅŸlat
                    confettiInterval = setInterval(createConfetti, 100); // Her 100ms'de bir konfeti
                    setTimeout(() => {
                        clearInterval(confettiInterval); // 5 saniye sonra durdur
                    }, 5000);
                }
            }

            // Mikrofon izinlerini al ve dinlemeye baÅŸla
            async function startListening() {
                if (isListening) return;

                startButton.textContent = "Dinleniyor...";
                startButton.disabled = true;

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    microphone = audioContext.createMediaStreamSource(stream);
                    
                    microphone.connect(analyser);
                    analyser.fftSize = 256; // Daha hÄ±zlÄ± analiz iÃ§in kÃ¼Ã§Ã¼k boyut
                    const bufferLength = analyser.frequencyBinCount;
                    const dataArray = new Uint8Array(bufferLength);

                    isListening = true;
                    statusText.textContent = "Mikrofon aktif. Ãœfle!";

                    const checkVolume = () => {
                        if (!isListening) return;

                        analyser.getByteFrequencyData(dataArray);
                        let sum = 0;
                        for (let i = 0; i < bufferLength; i++) {
                            sum += dataArray[i];
                        }
                        let average = sum / bufferLength;

                        // Ãœfleme algÄ±lama eÅŸiÄŸi (denemelerle ayarlanabilir)
                        const blowThreshold = 80; 

                        if (average > blowThreshold) {
                            console.log("Ãœfleme algÄ±landÄ±! Ses dÃ¼zeyi:", average);
                            blowOutAllFlames();
                        }

                        if (blownOutCount < totalCandles) {
                            requestAnimationFrame(checkVolume);
                        } else {
                            // TÃ¼m mumlar sÃ¶ndÃ¼ÄŸÃ¼nde durdur
                            stopListening();
                        }
                    };

                    checkVolume();

                } catch (err) {
                    console.error("Mikrofon eriÅŸimi reddedildi veya hata oluÅŸtu: ", err);
                    statusText.textContent = "Mikrofon eriÅŸimi gerekli! LÃ¼tfen izin verin.";
                    startButton.textContent = "Mikrofonu BaÅŸlat";
                    startButton.disabled = false;
                }
            }

            function stopListening() {
                if (!isListening) return;
                isListening = false;
                if (microphone) {
                    microphone.disconnect();
                    microphone.mediaStream.getTracks().forEach(track => track.stop());
                }
                if (audioContext) {
                    audioContext.close();
                }
                statusText.textContent = "";
            }

            startButton.addEventListener('click', startListening);

            // Sayfa kapatÄ±ldÄ±ÄŸÄ±nda mikrofonu kapat
            window.addEventListener('beforeunload', stopListening);
        });
    </script>

</body>
</html>
